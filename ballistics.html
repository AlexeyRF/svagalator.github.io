<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор баллистики</title>
    <style>
        :root {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-tertiary: #2d2d2d;
            --border-color: #444;
            --text-primary: #e0e0e0;
            --text-secondary: #90a4ae;
            --accent-blue: #64b5f6;
            --accent-green: #4fc3f7;
            --accent-purple: #bb86fc;
            --accent-orange: #ffb74d;
            --accent-red: #f85149;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            margin-bottom: 30px;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid #333;
            background: linear-gradient(135deg, #1a1a1a, #8b0000);
            border-radius: 10px;
        }
        
        h1 { 
            color: #64b5f6;
            font-size: 2.8em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #90a4ae;
            font-size: 1.2em;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .mode-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            padding: 15px;
            background-color: #1e1e1e;
            border-radius: 8px;
            border: 1px solid #444;
        }
        
        .mode-btn {
            padding: 12px 24px;
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #444;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            flex: 1;
            border-bottom: 3px solid transparent;
        }
        
        .mode-btn:hover {
            background-color: #3d3d3d;
            transform: translateY(-2px);
        }
        
        .mode-btn.active {
            background-color: #1565c0;
            border-color: #64b5f6;
            color: white;
        }
        
        .mode-content {
            padding: 30px;
            display: none;
        }
        
        .mode-content.active { 
            display: block; 
        }
        
        .input-section, .results-section {
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #333;
            transition: transform 0.3s ease;
            margin-bottom: 25px;
        }
        
        .input-section:hover, .results-section:hover {
            transform: translateY(-5px);
            border-color: #444;
        }
        
        .section-title {
            color: #4fc3f7;
            font-size: 1.5em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            color: #a5d6a7;
            font-size: 0.95em;
            font-weight: bold;
        }
        
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #2d2d2d;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #444;
        }
        
        .input-row input, .input-row select {
            padding: 8px;
            background-color: #333;
            color: #fff;
            border: 1px solid #555;
            border-radius: 4px;
        }
        
        .input-row input {
            flex: 1;
            text-align: center;
        }
        
        .input-row input:focus, .input-row select:focus {
            outline: none;
            border-color: #64b5f6;
        }
        
        .unit-selector {
            min-width: 100px;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background-color: #1976d2;
            color: white;
            flex: 2;
            min-width: 200px;
        }
        
        .btn-primary:hover {
            background-color: #1565c0;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #444;
            flex: 1;
        }
        
        .btn-secondary:hover {
            background-color: #3d3d3d;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background-color: #252525;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #1565c0;
        }
        
        .result-label {
            color: #bb86fc;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .result-value {
            color: #4fc3f7;
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .result-unit {
            color: #ffb74d;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .error-message {
            background-color: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .formula-info {
            background-color: rgba(255, 166, 87, 0.1);
            border: 1px solid rgba(255, 166, 87, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #ffb74d;
            font-size: 0.95em;
        }
        
        @media (max-width: 768px) {
            .input-grid { grid-template-columns: 1fr; }
            .results-grid { grid-template-columns: 1fr; }
            .buttons { flex-direction: column; }
            .btn { width: 100%; }
            .mode-selector { flex-direction: column; }
            .mode-btn { width: 100%; }
        }
    </style>
</head>
<body>
<div class="container">  
    <div class="mode-selector">
        <button class="mode-btn active" onclick="switchMode('standard')">
            <i class="fas fa-calculator"></i>Обычный режим
        </button>
        <button class="mode-btn" onclick="switchMode('inverse')">
            <i class="fas fa-search"></i>Поиск неизвестного
        </button>
<button class="mode-btn" onclick="window.location.href='index.html'">Вернуться в Механику</button>
                    
    </div>
    
    <div id="standard-mode" class="mode-content active">
        <div class="input-section">
            <h2 class="section-title"><i class="fas fa-sliders-h"></i>Входные параметры</h2>
            
            <div class="input-grid">
                <div class="input-group">
                    <label><i class="fas fa-tachometer-alt"></i>Начальная скорость (v₀)</label>
                    <div class="input-row">
                        <input type="number" id="initial-velocity" step="any" placeholder="Например: 100" value="100">
                        <select id="velocity-unit" class="unit-selector">
                            <option value="м/с">м/с</option>
                            <option value="км/ч">км/ч</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-angle-up"></i>Угол броска (α)</label>
                    <div class="input-row">
                        <input type="number" id="launch-angle" step="any" placeholder="Например: 45" value="45">
                        <select id="angle-unit" class="unit-selector">
                            <option value="град">градусы</option>
                            <option value="рад">радианы</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-clock"></i>Время (t)</label>
                    <div class="input-row">
                        <input type="number" id="time" step="any" placeholder="Например: 5" value="5">
                        <select id="time-unit" class="unit-selector">
                            <option value="с">секунды</option>
                            <option value="мин">минуты</option>
                        </select>
                    </div>
                    <div style="font-size: 0.85em; color: #90a4ae;">
                        Для расчета координат и скоростей в момент времени t
                    </div>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-weight"></i>Ускорение свободного падения (g)</label>
                    <div class="input-row">
                        <input type="number" id="gravity" step="any" placeholder="Например: 9.81" value="9.81">
                        <select id="gravity-unit" class="unit-selector">
                            <option value="м/с²">м/с²</option>
                        </select>
                    </div>
                    <div style="font-size: 0.85em; color: #90a4ae;">
                        Земля: 9.81 м/с², Луна: 1.62 м/с²
                    </div>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-ruler"></i>Начальная высота (y₀)</label>
                    <div class="input-row">
                        <input type="number" id="initial-height" step="any" placeholder="Например: 0" value="0">
                        <select id="height-unit" class="unit-selector">
                            <option value="м">метры</option>
                            <option value="км">километры</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" onclick="calculateStandard()">
                    <i class="fas fa-calculator"></i>Рассчитать все параметры
                </button>
                <button class="btn btn-secondary" onclick="clearStandardForm()">
                    <i class="fas fa-eraser"></i>Очистить форму
                </button>
            </div>
            
            <div class="error-message" id="error-standard"></div>
        </div>
        
        <div class="results-section">
            <h2 class="section-title"><i class="fas fa-chart-line"></i>Результаты расчётов</h2>
            <div class="results-grid" id="results-standard">
            </div>
            
            <div class="formula-info">
                <strong>Используемые формулы:</strong><br>
                • v₀x = v₀·cos(α)<br>
                • v₀y = v₀·sin(α)<br>
                • x(t) = v₀x·t<br>
                • y(t) = y₀ + v₀y·t - g·t²/2<br>
                • vx(t) = v₀x, vy(t) = v₀y - g·t<br>
                • v(t) = √(vx² + vy²)<br>
                • Дальность: L = v₀²·sin(2α)/g (при y₀=0)<br>
                • Высота: H = y₀ + (v₀²·sin²α)/(2g)<br>
                • Время подъёма: t_верх = v₀y/g<br>
                • Полное время: t_общ = 2·v₀y/g + √(2y₀/g)<br>
                • Угол в момент t: α = arctan(vy/vx)
            </div>
        </div>
    </div>
    
    <div id="inverse-mode" class="mode-content">
        <div class="input-section">
            <h2 class="section-title"><i class="fas fa-search"></i>Поиск неизвестного параметра</h2>
            <p style="color: #90a4ae; margin-bottom: 20px;">
                Введите известные параметры, оставьте пустым поле искомого параметра.
            </p>
            
            <div class="input-grid">
                <div class="input-group">
                    <label>Начальная скорость (v₀)</label>
                    <div class="input-row">
                        <input type="number" id="inv-initial-velocity" step="any" placeholder="Оставьте пустым для поиска">
                        <select id="inv-velocity-unit" class="unit-selector">
                            <option value="м/с">м/с</option>
                            <option value="км/ч">км/ч</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Угол броска (α)</label>
                    <div class="input-row">
                        <input type="number" id="inv-launch-angle" step="any" placeholder="Оставьте пустым для поиска">
                        <select id="inv-angle-unit" class="unit-selector">
                            <option value="град">градусы</option>
                            <option value="рад">радианы</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Дальность полёта (L)</label>
                    <div class="input-row">
                        <input type="number" id="inv-range" step="any" placeholder="Оставьте пустым для поиска">
                        <select id="inv-range-unit" class="unit-selector">
                            <option value="м">метры</option>
                            <option value="км">километры</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Максимальная высота (H)</label>
                    <div class="input-row">
                        <input type="number" id="inv-max-height" step="any" placeholder="Оставьте пустым для поиска">
                        <select id="inv-height-unit" class="unit-selector">
                            <option value="м">метры</option>
                            <option value="км">километры</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Полное время полёта (T)</label>
                    <div class="input-row">
                        <input type="number" id="inv-total-time" step="any" placeholder="Оставьте пустым для поиска">
                        <select id="inv-time-unit" class="unit-selector">
                            <option value="с">секунды</option>
                            <option value="мин">минуты</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Ускорение свободного падения (g)</label>
                    <div class="input-row">
                        <input type="number" id="inv-gravity" step="any" placeholder="Оставьте пустым для поиска" value="9.81">
                        <select id="inv-gravity-unit" class="unit-selector">
                            <option value="м/с²">м/с²</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" onclick="calculateInverse()">
                    <i class="fas fa-search"></i>Найти неизвестный параметр
                </button>
                <button class="btn btn-secondary" onclick="clearInverseForm()">
                    <i class="fas fa-eraser"></i>Очистить форму
                </button>
            </div>
            
            <div class="error-message" id="error-inverse"></div>
        </div>
        
        <div class="results-section">
            <h2 class="section-title"><i class="fas fa-check-circle"></i>Результат расчёта</h2>
            <div id="inverse-result" style="background-color: #252525; padding: 25px; border-radius: 10px; border-left: 5px solid #4fc3f7;">
                <div id="inverse-result-content" style="font-size: 1.3em; color: #e0e0e0; font-weight: 600;">
                    Введите данные и нажмите "Найти неизвестный параметр"
                </div>
                <div id="inverse-formula-used" style="margin-top: 15px; font-size: 0.9em; color: #90a4ae;">
                    Использованная формула будет показана здесь
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const UNIT_CONVERSIONS = {
        'м/с': 1,
        'км/ч': 1/3.6,
        
        'м': 1,
        'км': 1000,
        
        'с': 1,
        'мин': 60,
        
        'м/с²': 1,
        
        'град': Math.PI/180,
        'рад': 1
    };
    
    function convertToSI(value, unit) {
        if (value === null || isNaN(value)) return null;
        return value * UNIT_CONVERSIONS[unit];
    }
    
    function convertFromSI(value, unit) {
        if (value === null || isNaN(value)) return null;
        return value / UNIT_CONVERSIONS[unit];
    }
    
    function degreesToRadians(degrees) {
        return degrees * Math.PI / 180;
    }
    
    function radiansToDegrees(radians) {
        return radians * 180 / Math.PI;
    }
    
    function showError(mode, message) {
        const errorElement = document.getElementById(`error-${mode}`);
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        setTimeout(() => { errorElement.style.display = 'none'; }, 5000);
    }
    
    function switchMode(mode) {
        document.querySelectorAll('.mode-content').forEach(el => {
            el.classList.remove('active');
        });
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.getElementById(`${mode}-mode`).classList.add('active');
        document.querySelector(`.mode-btn[onclick="switchMode('${mode}')"]`).classList.add('active');
    }
    
    function calculateStandard() {
        const v0 = convertToSI(
            parseFloat(document.getElementById('initial-velocity').value),
            document.getElementById('velocity-unit').value
        );
        
        const angleInput = parseFloat(document.getElementById('launch-angle').value);
        const angleUnit = document.getElementById('angle-unit').value;
        const angleRad = convertToSI(angleInput, angleUnit);
        
        const t = convertToSI(
            parseFloat(document.getElementById('time').value),
            document.getElementById('time-unit').value
        );
        
        const g = convertToSI(
            parseFloat(document.getElementById('gravity').value),
            document.getElementById('gravity-unit').value
        );
        
        const y0 = convertToSI(
            parseFloat(document.getElementById('initial-height').value),
            document.getElementById('height-unit').value
        );
        
        if (isNaN(v0) || isNaN(angleRad) || isNaN(g)) {
            showError('standard', 'Заполните начальную скорость, угол и ускорение свободного падения');
            return;
        }
        
        if (v0 <= 0 || g <= 0) {
            showError('standard', 'Скорость и ускорение должны быть положительными');
            return;
        }
        
        const v0x = v0 * Math.cos(angleRad);
        const v0y = v0 * Math.sin(angleRad);
        
        let x_t = null, y_t = null;
        if (!isNaN(t) && t >= 0) {
            x_t = v0x * t;
            y_t = y0 + v0y * t - 0.5 * g * t * t;
        }
        
        let vx_t = null, vy_t = null;
        if (!isNaN(t) && t >= 0) {
            vx_t = v0x;
            vy_t = v0y - g * t;
        }
        
        let v_t1 = null, v_t2 = null;
        if (!isNaN(t) && t >= 0 && vx_t !== null && vy_t !== null) {
            v_t1 = Math.sqrt(vx_t * vx_t + vy_t * vy_t);
            if (y_t !== null) {
                const deltaY = y_t - y0;
                v_t2 = Math.sqrt(v0 * v0 - 2 * g * deltaY);
            }
        }
        
        const range = (v0 * v0 * Math.sin(2 * angleRad)) / g;
        
        const maxHeight = y0 + (v0y * v0y) / (2 * g);
        
        const timeToMaxHeight = v0y / g;
        
        const discriminant = v0y * v0y + 2 * g * y0;
        let totalTime = null;
        if (discriminant >= 0) {
            totalTime = (v0y + Math.sqrt(discriminant)) / g;
        }
        
        let angleAtTime = null;
        if (!isNaN(t) && t >= 0 && vx_t !== null && vy_t !== null && vx_t !== 0) {
            angleAtTime = Math.atan(vy_t / vx_t);
            if (vx_t < 0) angleAtTime += Math.PI; 
        }
        
        displayStandardResults({
            v0, v0x, v0y,
            x_t, y_t,
            vx_t, vy_t,
            v_t1, v_t2,
            range,
            maxHeight,
            timeToMaxHeight,
            totalTime,
            angleAtTime,
            angleRad,
            g,
            y0
        });
    }
    
    function displayStandardResults(data) {
        const container = document.getElementById('results-standard');
        
        const displayVelocity = value => convertFromSI(value, document.getElementById('velocity-unit').value).toFixed(3);
        const displayDistance = value => convertFromSI(value, document.getElementById('height-unit').value).toFixed(3);
        const displayTime = value => convertFromSI(value, document.getElementById('time-unit').value).toFixed(3);
        const displayAngle = value => {
            const angleUnit = document.getElementById('angle-unit').value;
            if (angleUnit === 'град') {
                return `${radiansToDegrees(value).toFixed(2)}°`;
            } else {
                return `${value.toFixed(4)} рад`;
            }
        };
        
        const results = [
            {
                label: "Начальная скорость по X",
                value: displayVelocity(data.v0x),
                unit: document.getElementById('velocity-unit').value,
                formula: "v₀x = v₀·cos(α)"
            },
            {
                label: "Начальная скорость по Y",
                value: displayVelocity(data.v0y),
                unit: document.getElementById('velocity-unit').value,
                formula: "v₀y = v₀·sin(α)"
            },
            {
                label: "Координата X в момент t",
                value: data.x_t !== null ? displayDistance(data.x_t) : "—",
                unit: document.getElementById('height-unit').value,
                formula: "x = v₀x·t"
            },
            {
                label: "Координата Y в момент t",
                value: data.y_t !== null ? displayDistance(data.y_t) : "—",
                unit: document.getElementById('height-unit').value,
                formula: "y = y₀ + v₀y·t - g·t²/2"
            },
            {
                label: "Скорость по X в момент t",
                value: data.vx_t !== null ? displayVelocity(data.vx_t) : "—",
                unit: document.getElementById('velocity-unit').value,
                formula: "vx = v₀x"
            },
            {
                label: "Скорость по Y в момент t",
                value: data.vy_t !== null ? displayVelocity(data.vy_t) : "—",
                unit: document.getElementById('velocity-unit').value,
                formula: "vy = v₀y - g·t"
            },
            {
                label: "Полная скорость в момент t",
                value: data.v_t1 !== null ? displayVelocity(data.v_t1) : "—",
                unit: document.getElementById('velocity-unit').value,
                formula: "v = √(vx² + vy²)"
            },
            {
                label: "Дальность полёта",
                value: displayDistance(data.range),
                unit: document.getElementById('height-unit').value,
                formula: "L = v₀²·sin(2α)/g"
            },
            {
                label: "Максимальная высота",
                value: displayDistance(data.maxHeight),
                unit: document.getElementById('height-unit').value,
                formula: "H = y₀ + (v₀y²)/(2g)"
            },
            {
                label: "Время подъёма",
                value: displayTime(data.timeToMaxHeight),
                unit: document.getElementById('time-unit').value,
                formula: "t_верх = v₀y/g"
            },
            {
                label: "Полное время полёта",
                value: data.totalTime !== null ? displayTime(data.totalTime) : "—",
                unit: document.getElementById('time-unit').value,
                formula: "t_общ = (v₀y + √(v₀y²+2gy₀))/g"
            },
            {
                label: "Угол в момент t",
                value: data.angleAtTime !== null ? displayAngle(data.angleAtTime) : "—",
                formula: "α = arctan(vy/vx)"
            }
        ];
        
        let html = '';
        results.forEach((item, index) => {
            html += `
                <div class="result-card">
                    <div class="result-label">
                        <i class="fas fa-${index % 2 === 0 ? 'calculator' : 'chart-line'}"></i>
                        ${item.label}
                    </div>
                    <div class="result-value">${item.value}</div>
                    ${item.unit ? `<div class="result-unit">${item.unit}</div>` : ''}
                    ${item.formula ? `<div style="font-size: 0.8em; color: #90a4ae; margin-top: 8px;">${item.formula}</div>` : ''}
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    function clearStandardForm() {
        document.getElementById('initial-velocity').value = '';
        document.getElementById('launch-angle').value = '';
        document.getElementById('time').value = '';
        document.getElementById('initial-height').value = '0';
        document.getElementById('results-standard').innerHTML = '';
    }
    
    function calculateInverse() {
        const v0 = getInverseValue('inv-initial-velocity', 'inv-velocity-unit');
        const angleInput = getInverseValue('inv-launch-angle', 'inv-angle-unit');
        const range = getInverseValue('inv-range', 'inv-range-unit');
        const maxHeight = getInverseValue('inv-max-height', 'inv-height-unit');
        const totalTime = getInverseValue('inv-total-time', 'inv-time-unit');
        const g = getInverseValue('inv-gravity', 'inv-gravity-unit', true) || convertToSI(9.81, 'м/с²');
        
        let angleRad = angleInput;
        
        let result = '';
        let formula = '';
        let foundParam = '';
        
        if (v0 === null && angleRad !== null) {
            if (range !== null && g !== null) {
                if (Math.sin(2 * angleRad) !== 0) {
                    const calculatedV0 = Math.sqrt(range * g / Math.sin(2 * angleRad));
                    result = `Начальная скорость: <strong>${formatInverseResult(calculatedV0, 'inv-velocity-unit')}</strong>`;
                    formula = `v₀ = √(L·g/sin(2α)) = √(${range.toFixed(2)}·${g.toFixed(2)}/sin(${radiansToDegrees(2*angleRad).toFixed(2)}°))`;
                    foundParam = 'v₀';
                }
            } else if (maxHeight !== null && g !== null) {
                if (Math.sin(angleRad) !== 0) {
                    const calculatedV0 = Math.sqrt(2 * g * maxHeight) / Math.sin(angleRad);
                    result = `Начальная скорость: <strong>${formatInverseResult(calculatedV0, 'inv-velocity-unit')}</strong>`;
                    formula = `v₀ = √(2gH)/sin(α) = √(2·${g.toFixed(2)}·${maxHeight.toFixed(2)})/sin(${radiansToDegrees(angleRad).toFixed(2)}°)`;
                    foundParam = 'v₀';
                }
            } else if (totalTime !== null && g !== null) {
                if (Math.sin(angleRad) !== 0) {
                    const calculatedV0 = (g * totalTime) / (2 * Math.sin(angleRad));
                    result = `Начальная скорость: <strong>${formatInverseResult(calculatedV0, 'inv-velocity-unit')}</strong>`;
                    formula = `v₀ = (gT)/(2sin(α)) = (${g.toFixed(2)}·${totalTime.toFixed(2)})/(2·sin(${radiansToDegrees(angleRad).toFixed(2)}°))`;
                    foundParam = 'v₀';
                }
            }
        }
        
        else if (angleInput === null && v0 !== null) {
            if (range !== null && g !== null) {
                const sin2alpha = range * g / (v0 * v0);
                if (Math.abs(sin2alpha) <= 1) {
                    const calculatedAngleRad = 0.5 * Math.asin(sin2alpha);
                    const angleUnit = document.getElementById('inv-angle-unit').value;
                    let displayAngle;
                    if (angleUnit === 'град') {
                        displayAngle = `${radiansToDegrees(calculatedAngleRad).toFixed(2)}°`;
                    } else {
                        displayAngle = `${calculatedAngleRad.toFixed(4)} рад`;
                    }
                    result = `Угол броска: <strong>${displayAngle}</strong>`;
                    formula = `α = 0.5·arcsin(L·g/v₀²) = 0.5·arcsin(${range.toFixed(2)}·${g.toFixed(2)}/${(v0*v0).toFixed(2)})`;
                    foundParam = 'α';
                }
            } else if (maxHeight !== null && g !== null && v0 !== null) {
                const sinAlpha = Math.sqrt(2 * g * maxHeight) / v0;
                if (Math.abs(sinAlpha) <= 1) {
                    const calculatedAngleRad = Math.asin(sinAlpha);
                    const angleUnit = document.getElementById('inv-angle-unit').value;
                    let displayAngle;
                    if (angleUnit === 'град') {
                        displayAngle = `${radiansToDegrees(calculatedAngleRad).toFixed(2)}°`;
                    } else {
                        displayAngle = `${calculatedAngleRad.toFixed(4)} рад`;
                    }
                    result = `Угол броска: <strong>${displayAngle}</strong>`;
                    formula = `α = arcsin(√(2gH)/v₀) = arcsin(√(2·${g.toFixed(2)}·${maxHeight.toFixed(2)})/${v0.toFixed(2)})`;
                    foundParam = 'α';
                }
            }
        }
        
        else if (range === null && v0 !== null && angleRad !== null && g !== null) {
            const calculatedRange = (v0 * v0 * Math.sin(2 * angleRad)) / g;
            result = `Дальность полёта: <strong>${formatInverseResult(calculatedRange, 'inv-range-unit')}</strong>`;
            formula = `L = v₀²·sin(2α)/g = ${(v0*v0).toFixed(2)}·sin(${radiansToDegrees(2*angleRad).toFixed(2)}°)/${g.toFixed(2)}`;
            foundParam = 'L';
        }
        
        else if (maxHeight === null && v0 !== null && angleRad !== null && g !== null) {
            const v0y = v0 * Math.sin(angleRad);
            const calculatedHeight = (v0y * v0y) / (2 * g);
            result = `Максимальная высота: <strong>${formatInverseResult(calculatedHeight, 'inv-height-unit')}</strong>`;
            formula = `H = (v₀²·sin²α)/(2g) = (${(v0*v0).toFixed(2)}·sin²(${radiansToDegrees(angleRad).toFixed(2)}°))/(2·${g.toFixed(2)})`;
            foundParam = 'H';
        }
        
        else if (totalTime === null && v0 !== null && angleRad !== null && g !== null) {
            const calculatedTime = (2 * v0 * Math.sin(angleRad)) / g;
            result = `Полное время полёта: <strong>${formatInverseResult(calculatedTime, 'inv-time-unit')}</strong>`;
            formula = `T = (2·v₀·sinα)/g = (2·${v0.toFixed(2)}·sin(${radiansToDegrees(angleRad).toFixed(2)}°))/${g.toFixed(2)}`;
            foundParam = 'T';
        }
        
        else if (g === null && v0 !== null && angleRad !== null) {
            if (range !== null) {
                const calculatedG = (v0 * v0 * Math.sin(2 * angleRad)) / range;
                result = `Ускорение свободного падения: <strong>${formatInverseResult(calculatedG, 'inv-gravity-unit')}</strong>`;
                formula = `g = v₀²·sin(2α)/L = ${(v0*v0).toFixed(2)}·sin(${radiansToDegrees(2*angleRad).toFixed(2)}°)/${range.toFixed(2)}`;
                foundParam = 'g';
            } else if (maxHeight !== null) {
                const v0y = v0 * Math.sin(angleRad);
                const calculatedG = (v0y * v0y) / (2 * maxHeight);
                result = `Ускорение свободного падения: <strong>${formatInverseResult(calculatedG, 'inv-gravity-unit')}</strong>`;
                formula = `g = (v₀²·sin²α)/(2H) = (${(v0*v0).toFixed(2)}·sin²(${radiansToDegrees(angleRad).toFixed(2)}°))/(2·${maxHeight.toFixed(2)})`;
                foundParam = 'g';
            }
        }
        
        if (result) {
            document.getElementById('inverse-result-content').innerHTML = result;
            document.getElementById('inverse-formula-used').innerHTML = `<i class="fas fa-square-root-alt"></i> ${formula}`;
            showError('inverse', `Найден параметр: ${foundParam}!`);
        } else {
            showError('inverse', 'Недостаточно данных для расчёта или некорректный ввод. Проверьте, что оставлено ровно одно поле пустым.');
        }
    }
    
    function getInverseValue(inputId, unitId, allowZero = false) {
        const input = document.getElementById(inputId);
        const unit = document.getElementById(unitId).value;
        const value = input.value.trim();
        
        if (value === '') return null;
        
        const numValue = parseFloat(value);
        if (isNaN(numValue)) return null;
        if (!allowZero && numValue <= 0) return null;
        
        return convertToSI(numValue, unit);
    }
    
    function formatInverseResult(value, unitSelectId) {
        const unit = document.getElementById(unitSelectId).value;
        const converted = convertFromSI(value, unit);
        return `${converted.toFixed(3)} ${unit}`;
    }
    
    function clearInverseForm() {
        document.getElementById('inv-initial-velocity').value = '';
        document.getElementById('inv-launch-angle').value = '';
        document.getElementById('inv-range').value = '';
        document.getElementById('inv-max-height').value = '';
        document.getElementById('inv-total-time').value = '';
        document.getElementById('inv-gravity').value = '9.81';
        
        document.getElementById('inverse-result-content').innerHTML = 
            'Введите данные и нажмите "Найти неизвестный параметр"';
        document.getElementById('inverse-formula-used').innerHTML = 'Использованная формула будет показана здесь';
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const activeMode = document.querySelector('.mode-content.active').id;
                    if (activeMode === 'standard-mode') calculateStandard();
                    else if (activeMode === 'inverse-mode') calculateInverse();
                }
            });
        });
    });
</script>
</body>
</html>
